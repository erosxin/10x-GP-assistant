# UI 结构优化说明

## 🎯 优化目标

净化侧边栏，实现页面导航模式，将分析工作台和知识库管理功能分离。

## ✨ 主要改动

### 1. 侧边栏重构

#### 导航栏
- 使用 `st.sidebar.radio` 创建页面导航
- 两个主要选项：
  - `🚀 AI 分析工作台` (默认页)
  - `📂 全量知识库` (数据管理页)

#### 最近记录微件
- 显示最近 5 条项目记录
- 格式：`[YYYY-MM-DD] 项目名称`
- 简洁清晰，不占用过多空间

#### 保留的功能
- API 配置（Base URL, API Key, Model）
- 分析模式选择（仅在工作台页面显示）

#### 移除的内容
- ❌ 项目知识库 DataFrame 表格预览
- ❌ 详细的历史记录展开卡片

### 2. 页面路由逻辑

#### 模式 A：AI 分析工作台
- 文件上传器（支持 PDF/DOCX）
- 开始分析按钮
- 流式显示分析结果
- Word 报告导出功能
- 清除结果按钮

#### 模式 B：全量知识库
- **统计指标展示**：
  - 📊 已收录项目数
  - ⭐ 平均评分
  - 🔥 最热赛道
  - 🏆 最高赛道项目数

- **数据表格**：
  - 全量数据展示
  - 日期格式化为 YYYY-MM-DD（去掉具体时间）
  - 支持排序、搜索和筛选
  - 使用 `use_container_width=True` 充分利用空间
  - 表格高度 600px，便于查看更多数据

- **数据导出**：
  - CSV 格式导出（支持 Excel 打开）
  - JSON 格式导出

- **赛道分布分析**：
  - 显示各赛道的项目数量
  - 按项目数排序

### 3. 辅助函数

#### `format_timestamp_for_display(timestamp_str)`
- 将时间戳格式化为 YYYY-MM-DD 格式
- 支持多种时间格式输入
- 容错处理

#### `get_recent_projects(limit=5)`
- 获取最近的项目记录
- 返回格式化的日期和项目名称列表

#### `calculate_kb_statistics(df)`
- 计算知识库统计指标
- 包括：项目总数、平均评分、最热赛道、赛道分布

## 🔧 技术细节

### 日期处理
- 使用 `format_timestamp_for_display` 统一格式化日期
- 确保表格中只显示 YYYY-MM-DD，不包含时间部分
- 支持多种时间格式的解析

### 数据加载
- 使用 `try-except` 包裹文件读取逻辑
- 错误提示友好，不显示大段报错信息
- 知识库为空时显示友好提示

### 表格优化
- 使用 `st.dataframe` 的完整功能
- 启用排序和搜索
- 自适应容器宽度
- 隐藏索引，界面更简洁

### 代码结构
- 清晰的页面路由逻辑
- 变量作用域正确
- 条件渲染优化性能

## 📋 使用说明

### 切换到知识库页面
1. 在侧边栏顶部选择 `📂 全量知识库`
2. 查看统计指标和全量数据表格
3. 可以使用表格的排序、搜索功能
4. 导出数据为 CSV 或 JSON 格式

### 使用分析工作台
1. 在侧边栏顶部选择 `🚀 AI 分析工作台`（默认）
2. 选择分析模式
3. 上传文件并开始分析
4. 查看结果并导出 Word 报告

### 查看最近记录
- 在侧边栏的"最近记录"区域查看最新 5 条项目
- 格式：`[YYYY-MM-DD] 项目名称`

## ⚠️ 注意事项

1. **向后兼容**：所有原有功能保持不变，只是重新组织界面
2. **自动保存**：分析完成后依然自动保存到知识库
3. **数据格式**：CSV 文件使用 `utf-8-sig` 编码，支持中文和 Excel 打开
4. **性能优化**：知识库页面使用高效的数据加载方式，避免界面卡顿

## 🔄 后续优化建议

1. **搜索和筛选**：为知识库添加高级搜索和筛选功能
2. **项目详情页**：点击最近记录或表格中的项目，跳转到详情页
3. **数据可视化**：添加图表展示赛道分布、评分趋势等
4. **批量操作**：支持批量导出、批量删除等操作
